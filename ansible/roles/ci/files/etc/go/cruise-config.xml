<?xml version="1.0" encoding="utf-8"?>
<cruise xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="cruise-config.xsd" schemaVersion="75">
    <server artifactsdir="artifacts" commandRepositoryLocation="default" serverId="ab50ac2b-bd00-427e-a87e-be78aeb7da4f" />
    <pipelines group="ProjectName">
        <pipeline name="Prepare">
            <materials>
                <git url="/home/git/mysite.git" branch="development" />
            </materials>
            <stage name="Verify">
                <jobs>
                    <job name="verify">
                        <tasks>
                            <exec command="fab">
                                <arg>ci.verify</arg>
                                <runif status="passed" />
                            </exec>
                        </tasks>
                    </job>
                </jobs>
            </stage>
            <stage name="Install">
                <jobs>
                    <job name="package">
                        <tasks>
                            <exec command="fab">
                                <arg>ci.install</arg>
                                <runif status="passed" />
                            </exec>
                        </tasks>
                    </job>
                </jobs>
            </stage>
            <stage name="CreateArtifact">
                <jobs>
                    <job name="Build">
                        <tasks>
                            <exec command="fab">
                                <arg>build</arg>
                                <arg>--set</arg>
                                <arg>python_executable=env/bin/python,settings=mysite.settings.vagrant</arg>
                                <runif status="passed" />
                            </exec>
                        </tasks>
                        <artifacts>
                            <artifact src="dist" dest="dist" />
                        </artifacts>
                    </job>
                </jobs>
            </stage>
            <stage name="Deploy">
                <jobs>
                    <job name="staging">
                        <tasks>
                            <exec command="fab">
                                <arg>deploy.development</arg>
                            </exec>
                        </tasks>
                    </job>
                </jobs>
            </stage>
        </pipeline>
        <pipeline name="Test">
            <materials>
                <pipeline pipelineName="Prepare" stageName="Deploy" materialName="Artifact" />
            </materials>
            <stage name="Development">
                <jobs>
                    <job name="functional">
                        <tasks>
                            <exec command="fab">
                                <arg>--list</arg>
                                <runif status="passed" />
                            </exec>
                        </tasks>
                    </job>
                </jobs>
            </stage>
        </pipeline>
    </pipelines>
    <agents>
        <agent hostname="vagrant-ubuntu-trusty-64" ipaddress="10.0.2.15" uuid="13c1c77c-f4bb-4873-9450-9874544548fd" />
    </agents>
</cruise>

